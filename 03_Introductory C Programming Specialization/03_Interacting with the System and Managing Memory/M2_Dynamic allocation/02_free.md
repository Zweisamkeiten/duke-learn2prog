---
date created: 2022-10-17 20:01
date updated: 2022-10-17 20:04
---

## free

与分配在栈上的内存不同（一旦与该栈帧关联的函数返回就释放），堆上的内存必须由程序员显式释放

**free** 函数

![](attachments/Pasted%20image%2020221017200144.png)
参数：需要释放的内存的起始地址。 此起始地址应与 **malloc** _返回的地址匹配。_ 作为一个好的经验法则，由 malloc 分配的每个内存块都应该 在程序执行的稍后位置通过相应的 free 调用来释放

任何解引用指向该内存块的指针的尝试都是错误的——这些指针是悬空的。 当然，与所有悬空指针一样，究竟会发生什么是未定义的。

按照 **p** 的箭头（应该到达堆中的一块内存，或者为 NULL），然后擦除整个内存块。 如果 **p** 为 NULL，则什么也不会发生。 如果 **p** 指向的不是堆中块的开头，那就是一个错误，并且会发生不好的事情（程序可能会崩溃，但可能会发生更糟糕的事情）。

#important
请注意，free 只会释放您要求它释放的内存块。 如果该内存块包含指向堆中其他块的其他指针，并且您也完成了该内存，则应在释放包含这些指针的内存块之前释放这些内存块。

```c
polygon_t * p = makeRectangle(c1, c2);
//stuff that uses p
//...
//done with p and its points
free(p->points); // 先释放结构体内指针的内存
free(p); // 再释放结构体的内存
```


